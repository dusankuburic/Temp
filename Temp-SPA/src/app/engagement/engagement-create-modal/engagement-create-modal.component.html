<div class="modal-header-obsidian">
    <h4 class="modal-title-obsidian">{{title}}</h4>
    <button type="button" class="modal-close-obsidian" aria-label="Close" (click)="bsModalRef.hide()">
        <span class="modal-close-icon" aria-hidden="true">Ã—</span>
    </button>
</div>
<div class="modal-body-obsidian">
    <tabset>
        <tab heading="Form">
            <div class="pt-3">
                <tmp-card variant="subtle">
                    <h4>Name: {{employee?.firstName}} {{employee?.lastName}}</h4>
                </tmp-card>

                <form [formGroup]="createEngagementForm" (ngSubmit)="create()">
                    <div class="modal-form-section">
                        <tmp-select [options]="workplacesList" [label]="'Workplace'" formControlName="workplaceId"></tmp-select>
                        <tmp-input [formControl]="salary" [type]="'number'" [label]="'Salary'" [placeholder]="'Enter Salary'"></tmp-input>
                        <tmp-datepicker [formControl]="dateFrom" [label]="'Date From'" [placeholder]="'Enter Date From'"></tmp-datepicker>
                        <tmp-datepicker [formControl]="dateTo" [label]="'Date To'" [placeholder]="'Enter Date To'"></tmp-datepicker>
                        <tmp-select [options]="employmentStatusesList" [label]="'Employment Status'" formControlName="employmentStatusId"></tmp-select>
                    </div>

                    <div class="modal-actions">
                        <tmp-button type="submit" variant="success" [disabled]="!createEngagementForm.valid">Create Engagement</tmp-button>
                    </div>
                </form>
            </div>
        </tab>
        <tab heading="Engagements">
            <div class="pt-3">
                <div class="table-responsive">
                    <table class="table table-striped table-hover text-center">
                        <thead>
                            <tr>
                                <th>Workplace</th>
                                <th>Employment status</th>
                                <th>Salary</th>
                                <th>From</th>
                                <th>To</th>
                            </tr>
                        </thead>
                        @if (existingEngagements.length !== 0) {
                        <tbody>
                            @for (data of existingEngagements; track data.workplaceName) {
                            <tr>
                                <td>{{data.workplaceName}}</td>
                                <td>{{data.employmentStatusName}}</td>
                                <td>{{data.salary}}</td>
                                <td>{{data.dateFrom | date }}</td>
                                <td>{{data.dateTo | date }}</td>
                            </tr>
                            }
                        </tbody>
                        }
                    </table>
                </div>
                @if (existingEngagements.length === 0) {
                <tmp-card variant="filled">
                    Employee doesn't have assigned engagement
                </tmp-card>
                }
            </div>
        </tab>
        <tab heading="Files">
            <div class="pt-3">
                <div class="employee-files-grid">
                    <tmp-card variant="filled" class="upload-card">
                        <h4 class="section-title">Upload Files</h4>
                        <div class="modal-form-section modal-form-section-tight">
                            <div class="row">
                            <div class="col-6 col-xl-12 mb-3">
                                @if (employeeId) {
                                <tmp-file-upload
                                    [label]="'Upload Photo'"
                                    [fileType]="'Image'"
                                    [maxSizeMB]="5"
                                    [employeeId]="employeeId"
                                    [uploadedFiles]="employeeFiles"
                                    [customFolder]="'employees/' + employeeId + '/images'"
                                    [compact]="true"
                                    (fileUploaded)="onFileUploaded($event)"
                                    (fileDeleted)="onFileDeleted($event)">
                                </tmp-file-upload>
                                }
                            </div>
                            <div class="col-6 col-xl-12 mb-3">
                                @if (employeeId) {
                                <tmp-file-upload
                                    [label]="'Upload Documents'"
                                    [fileType]="'Document'"
                                    [maxSizeMB]="10"
                                    [employeeId]="employeeId"
                                    [uploadedFiles]="employeeFiles"
                                    [customFolder]="'employees/' + employeeId + '/documents'"
                                    [compact]="true"
                                    (fileUploaded)="onFileUploaded($event)"
                                    (fileDeleted)="onFileDeleted($event)">
                                </tmp-file-upload>
                                }
                            </div>
                            </div>
                        </div>
                    </tmp-card>
    
                    <tmp-card variant="filled" class="files-table-card" style="overflow: visible;">
                        <h4 class="section-title">File Library</h4>
                        <tmp-table [hoverable]="true" [data]="paginatedFiles" [columns]="fileColumns">
                            <ng-template #rowTemplate let-file>
                                <tr>
                                    <td class="file-name" [attr.title]="file.name" style="width: 50%;">{{file.displayName || file.name}}</td>
                                    <td style="width: 20%;">{{file.fileTypeDisplay || file.fileType}}</td>
    
                                    <td class="text-center" style="width: 30%;">
                                        <div class="tmp-button-group justify-content-center">
                                            <tmp-button variant="subtle" size="small" (clicked)="downloadFile(file)" ariaLabel="Download file {{file.displayName}}">
                                                <fa-icon [icon]="downloadIcon" [size]="'xl'"></fa-icon>
                                            </tmp-button>
                                            <tmp-button variant="danger" size="small" (clicked)="removeFile(file)" ariaLabel="Delete file {{file.displayName}}">
                                                <fa-icon [icon]="removeIcon" [size]="'xl'"></fa-icon>
                                            </tmp-button>
                                        </div>
                                    </td>
                                </tr>
                            </ng-template>
                        </tmp-table>
                        <div class="mt-3 d-flex justify-content-center p-2">
                            <tmp-pagination
                                [totalCount]="employeeFiles.length"
                                [pageSize]="pageSize"
                                [pageNumber]="pageNumber"
                                (pageChanged)="onPageChanged($event)">
                            </tmp-pagination>
                        </div>
                    </tmp-card>
                </div>
            </div>
        </tab>
    </tabset>
</div>
